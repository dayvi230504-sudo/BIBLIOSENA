<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Formulario de Registro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/registro.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="form-container">
        <h2>INGRESE INFORMACION</h2>
        <form id="regForm" method="post">
            <label for="nombre">NOMBRE COMPLETO</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="tipo_documento">TIPO DE DOCUMENTO</label>
            <select id="tipo_documento" name="tipo_documento" required>
                <option value="">Seleccione</option>
                <option value="cedula">Cédula de Ciudadanía</option>
                <option value="tarjeta">Tarjeta de Identidad</option>
                <option value="extranjera">Cédula de Extranjería</option>
                <option value="nit">NIT</option>
            </select>

            <label for="ficha">NUMERO DE FICHA</label>
            <input type="text" id="ficha" name="ficha" required>

            <label for="documento">NUMERO DE DOCUMENTO</label>
            <input type="text" id="documento" name="documento" required>

            <label for="correo">CORREO</label>
            <input type="email" id="correo" name="correo" required>

            <label for="telefono">NUMERO DE TELEFONO</label>
            <input type="text" id="telefono" name="telefono" required>

            <label for="tipo_usuario">TIPO DE USUARIO</label>
            <select id="tipo_usuario" name="tipo_usuario" required>
                <option value="">Seleccione</option>
                <option value="aprendiz">Aprendiz</option>
                <option value="instructor">Instructor</option>
            </select>

            <div class="terminos">
                <input type="checkbox" id="acepta" name="acepta" required>
                <label for="acepta">Aceptar términos</label>
            </div>

            <label for="username">USUARIO</label>
            <input type="text" id="username" name="username" required>

            <label for="password">CONTRASEÑA</label>
            <input type="password" id="password" name="password" required>

            <button type="submit">ENVIAR</button>
        </form>
    </div>
    <script>
      function mostrarSwal(icono, titulo, texto, opciones = {}) {
        return Swal.fire({
          icon: icono,
          title: titulo,
          text: texto,
          confirmButtonText: 'Aceptar',
          confirmButtonColor: '#3085d6',
          ...opciones
        });
      }

      const form = document.getElementById('regForm');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = {
          nombre: document.getElementById('nombre').value,
          documento: document.getElementById('documento').value,
          correo: document.getElementById('correo').value,
          username: document.getElementById('username').value,
          password: document.getElementById('password').value,
          role: 'user'
        };
        try {
          const res = await fetch('/api/usuarios', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
          const data = await res.json();
          if (res.ok && data.ok) {
            await mostrarSwal('success', 'Usuario creado', 'Ya puedes iniciar sesión.');
            window.location.href = 'login.html';
          } else {
            await mostrarSwal('error', 'No se pudo registrar', data.error || 'Intenta nuevamente.');
          }
        } catch (e) {
          await mostrarSwal('error', 'Error de red', 'No fue posible registrar el usuario.');
        }
      });
    </script>
</body>
</html>
